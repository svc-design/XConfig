APP_NAME := craftweave
MAIN_FILE := main.go
MODULE := craftweave
TAG ?= latest
PLAYBOOK ?= examples/deploy.yaml

.PHONY: all build run clean init ansible playbook vault cmdb plugin help

all: build

init:
	go mod init craftweave
	GOPROXY=https://goproxy.cn,direct go get github.com/spf13/cobra@latest
	go mod tidy

build:
	go build -o $(APP_NAME) $(MAIN_FILE)

run:
	go run $(MAIN_FILE)

ansible:
	go run $(MAIN_FILE) ansible all -m ping

playbook:
	go run $(MAIN_FILE) playbook $(PLAYBOOK)

vault:
	go run $(MAIN_FILE) vault

cmdb:
	go run $(MAIN_FILE) cmdb export --format json > cmdb-graph.json

plugin:
	go run $(MAIN_FILE) plugin run ./plugins/hello.wasm

clean:
	rm -f $(APP_NAME)

help:
	@echo "ğŸ§¶ CraftWeave CLI Usage"
	@echo ""
	@echo "make build                ç¼–è¯‘ craftweave å¯æ‰§è¡Œæ–‡ä»¶"
	@echo "make run                  è¿è¡Œé»˜è®¤å…¥å£"
	@echo "make ansible              æ‰§è¡Œ ansible all -m ping"
	@echo "make playbook             æ‰§è¡Œé»˜è®¤ playbook æ–‡ä»¶"
	@echo "make vault                åŠ è§£å¯†å‘½ä»¤ï¼ˆå ä½ï¼‰"
	@echo "make cmdb                 è¾“å‡ºå›¾æ•°æ®åº“æ ¼å¼"
	@echo "make plugin               åŠ è½½è¿è¡Œæ’ä»¶ï¼ˆWASMï¼‰"
	@echo "make init                 åˆå§‹åŒ–ä¾èµ–ï¼ˆgo mod tidyï¼‰"
	@echo "make clean                æ¸…ç†æ„å»ºäº§ç‰©"
